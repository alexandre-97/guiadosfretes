{% comment %} Arquivo: seu_projeto/templates/base.html (VERSÃO COM CSS NUCLEAR) {% endcomment %}
{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PreciFlow{% endblock %}</title>
    <link rel="icon" href="{% static 'assets/images/logo/PF.png' %}" type="image/x-icon">
    <link rel="shortcut icon" href="{% static 'assets/images/logo/PF.png' %}" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/vendor/bootstrap/bootstrap.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/vendor/tabler-icons/tabler-icons.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/vendor/simplebar/simplebar.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/responsive.css' %}">

<style>
    /* ========================================================== */
    /* ========= ESTILO FINAL E COMPLETO (OUT/2025) ========= */
    /* ========================================================== */


    /* PARTE 1: Estilo da Barra de Busca
    ---------------------------------------------------------- */

    /* 1.1: Define as variáveis de cores para o TEMA CLARO (Padrão) */
    #searchForm .input-group {
        --search-bg: #fff;
        --search-border: #ced4da;
        --search-border-focus: #888;
        --search-text: #212529;
        --search-placeholder: #6c757d;
        --search-btn-gradient-start: #f8f9fa;
        --search-btn-gradient-end: #e9ecef;
        --search-btn-icon: #495057;
        --search-btn-icon-focus: #000;
    }

    /* 1.2: SOBRESCREVE as variáveis quando o TEMA ESCURO está ativo */
    body.dark #searchForm .input-group {
        --search-bg: #2b3035;
        --search-border: #4d545c;
        --search-border-focus: #9fa6ac;
        --search-text: #dee2e6;
        --search-placeholder: #8a9198;
        --search-btn-gradient-start: #495057;
        --search-btn-gradient-end: #3a3f44;
        --search-btn-icon: #ced4da;
        --search-btn-icon-focus: #fff;
    }

    /* 1.3: Estilo principal da barra (usa as variáveis) */
    #searchForm .input-group {
        border: 1px solid var(--search-border);
        border-radius: 0.375rem;
        transition: border-color 0.15s ease-in-out;
        background-color: var(--search-bg);
        display: flex;
    }

    #searchForm .input-group .form-control {
        border: none;
        box-shadow: none;
        outline: none;
        background-color: transparent;
        color: var(--search-text);
        flex: 1;
    }
    
    #searchForm .input-group .form-control::placeholder {
        color: var(--search-placeholder);
    }

    #searchForm .input-group .btn {
        border: none;
        box-shadow: none;
        outline: none;
        background-color: transparent;
        color: var(--search-btn-icon);
        transition: background-color 0.15s ease-in-out;
    }

    /* 1.4: Estilos de Foco e Hover (usam as variáveis) */
    #searchForm .input-group:focus-within {
        border-color: var(--search-border-focus);
    }

    #searchForm .input-group:focus-within .btn,
    #searchForm .input-group .btn:hover {
        background-image: linear-gradient(to bottom, var(--search-btn-gradient-start), var(--search-btn-gradient-end));
        color: var(--search-btn-icon-focus);
    }


    /* PARTE 2: Estilo do Dropdown de Notificações (Sino)
    ---------------------------------------------------------- */

    /* 2.1: Layout Flexbox para cada item da lista */
.notification-dropdown-item {
    display: flex;
    justify-content: space-between;
    /* ALTERAÇÃO: Alinha os itens no topo, fica melhor com múltiplas linhas */
    align-items: flex-start; 
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    transition: background-color 0.2s;
    gap: 15px; /* Aumentei o espaço entre título e data */
}

.notification-dropdown-item:hover {
    background-color: #f8f9fa;
}

/* 2.2: Estilo do Título (com a correção de quebra de linha) */
.notification-dropdown-item .notification-title {
    font-weight: 600;
    color: #212529;
    flex: 1;
    /* ALTERAÇÃO: As 3 linhas abaixo foram removidas para permitir a quebra de linha */
    /* white-space: nowrap; */
    /* overflow: hidden; */
    /* text-overflow: ellipsis; */
    white-space: normal; /* Garante a quebra de linha */
}

/* 2.3: Estilo da Data */
.notification-dropdown-item .notification-date {
    font-size: 0.75rem;
    color: #6c757d;
    white-space: nowrap;
    /* Adicionado para alinhar com a primeira linha do título */
    padding-top: 2px;
}

/* 2.4: CORREÇÃO FINAL - Anula estilos conflitantes do tema para o título */
.app-wrapper .notification-dropdown-item .notification-title {
    visibility: visible !important;
    line-height: normal !important;
}

/* 2.5: Estilos para o Tema Escuro */
body.dark .notification-dropdown-item {
    border-bottom-color: #3a3f44;
}

body.dark .notification-dropdown-item:hover {
    background-color: #343a40;
}

body.dark .notification-dropdown-item .notification-title {
    color: #dee2e6;
}

body.dark .notification-dropdown-item .notification-date {
    color: #adb5bd;
}

</style>
    {% block page_styles %}{% endblock %}
</head>
<body class="no-transitions">
    <script>
        (function() {
            try {
                var theme = localStorage.getItem('theme-mode');
                if (theme === 'dark') {
                    document.body.classList.remove('light');
                    document.body.classList.add('dark');
                } else {
                    document.body.classList.remove('dark');
                    document.body.classList.add('light');
                }
            } catch (e) {
                document.body.classList.add('light');
            }
        })();
    </script>
    <div class="loader-wrapper">
        <div class="loader_24"></div>
    </div>
    <div class="app-wrapper">
        {% include 'parciais/_base_sidebar.html' %}
        <div class="app-content">
            {% include 'parciais/_base_header.html' %}
            <main>
                <div class="container-fluid">
                    <div class="row m-1"><div class="col-12"><h4 class="main-title">{% block page_title %}Título da Página{% endblock %}</h4>{% block breadcrumb %}{% endblock %}</div></div>
                    <div class="row m-1"><div class="col-12">{% include 'parciais/_messages.html' %}</div></div>
                    {% block content %}{% endblock content %}
                </div>
            </main>
            <footer>
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-9 col-12"><p class="footer-text f-w-600 mb-0">Copyright © 2025 PreciFlow. Todos os direitos reservados.</p></div>
                        <div class="col-md-3"><div class="footer-text text-end"><p class="footer-text f-w-600 mb-0">Desenvolvido por Alexandre</p></div></div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <script>window.jQuery || document.write('<script src="{% static 'assets/js/jquery-3.6.3.min.js' %}"><\/script>')</script>
    <script src="{% static 'assets/vendor/bootstrap/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/vendor/simplebar/simplebar.js' %}"></script>
    <script src="{% static 'assets/js/script.js' %}"></script>
    <script src="{% static 'assets/custom/js/app.js' %}"></script>

<script>
$(document).ready(function() {
    const dropdown = $('#notificationDropdown');
    const badge = $('#notificationBadge');
    const notificationList = $('#notificationList');

    dropdown.on('click', function(event) {
        event.stopPropagation();
    });

    notificationList.on('click', '.notification-dropdown-item', function(event) {
        const item = $(this);
        const postId = item.data('post-id');
        if (!postId) return;

        item.css('pointer-events', 'none');

        fetch("{% url 'quoteflow:mark_update_as_read' %}", {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}' },
            body: JSON.stringify({ post_id: postId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = "{% url 'quoteflow:updates_list' %}";
            }
        })
        .catch(error => {
            console.error('Erro na requisição:', error);
            item.css('pointer-events', 'auto'); 
        });
    });
});
</script>
    
    {% block page_scripts %}{% endblock %}
</body>
</html>